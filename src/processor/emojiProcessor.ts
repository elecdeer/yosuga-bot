import {
  existsPronunciation,
  getEmojiRegExp,
  getPronunciation,
} from "@elecdeer/emoji-pronunciation-ja";

import { processorLogger, ProcessorProvider } from "./processorChain";

const emojiReg = getEmojiRegExp("g");

export const emojiProcessor: ProcessorProvider<void> = () => async (speechText) => {
  // console.log("絵文字: " + speechText.match(reg));
  return {
    ...speechText,
    text: speechText.text.replace(emojiReg, (match) => {
      if (exceptionEmojis[match]) {
        return match;
      }

      const pronunciation = existsPronunciation(match) ? getPronunciation(match) : "絵文字";

      processorLogger.debug(`${match} => ${pronunciation}`);
      return pronunciation;
    }),
  };
};

//emoji-pronunciation-jaの方直した方がいい気もする
const exceptionEmojis: Record<string, string> = {
  "{": "{",
  "‾": "‾",
  _: "_",
  "-": "ハイフン",
  "‐": "ハイフン",
  "–": "–",
  "—": "—",
  "―": "―",
  "・": "点",
  ",": ",",
  "،": "،",
  "、": "、",
  ";": ";",
  "؛": "؛",
  ":": ":",
  "؟": "?",
  "‽": "インテロバング",
  ".": ".",
  "…": "…",
  "。": "。",
  "·": "点",
  "'": "'",
  "‘": "‘",
  "’": "’",
  "‚": "‚",
  "“": "“",
  "”": "”",
  "„": "„",
  "«": "括弧",
  "»": "括弧とじ",
  ")": "括弧とじ",
  "[": "括弧",
  "]": "括弧とじ",
  "}": "括弧とじ",
  "〈": "括弧",
  "〉": "括弧とじ",
  "《": "括弧",
  "》": "括弧とじ",
  "「": "括弧",
  "」": "括弧とじ",
  "『": "括弧",
  "』": "括弧とじ",
  "【": "括弧",
  "】": "括弧とじ",
  "〔": "括弧",
  "〕": "括弧とじ",
  "〖": "括弧",
  "〗": "括弧とじ",
  "§": "節",
  "¶": "段落",
  "@": "アット",
  "*": "アスタリスク",
  "/": "スラッシュ",
  "\\": "バックスラッシュ",
  "&": "アンド",
  "#": "ハッシュ",
  "%": "パーセント",
  "‰": "パーミル",
  "†": "†",
  "‡": "‡",
  "•": "点",
  "‧": "点",
  "′": "′",
  "″": "″",
  "‴": "‴",
  "‸": "‸",
  "※": "こめ",
  "⁂": "アステリズム",
  "`": "グレイヴ",
  "´": "アキュート",
  "^": "^",
  "¨": "¨",
  "°": "度",
  "℗": "原盤権マーク",
  "←": "左",
  "↚": "左",
  "→": "右",
  "↛": "右",
  "↑": "上",
  "↓": "下",
  "↜": "左",
  "↝": "右",
  "↞": "左",
  "↟": "上",
  "↠": "右",
  "↡": "下",
  "↢": "左",
  "↣": "右",
  "↤": "左",
  "↥": "上",
  "↦": "右",
  "↧": "下",
  "↨": "上下",
  "↫": "左",
  "↬": "右",
  "↭": "左右",
  "↯": "下",
  "↰": "上左",
  "↱": "上右",
  "↲": "下左",
  "↳": "下右",
  "↴": "右下",
  "↵": "下左",
  "⇅": "上下",
  "⇆": "左右",
  "∆": "デルタ",
  "∇": "ナブラ",
  "∈": "属する",
  "+": "プラス",
  "±": "プラスマイナス",
  "÷": "割る",
  "×": "掛ける",
  "<": "小なり",
  "=": "イコール",
  "≠": "ノットイコール",
  ">": "大なり",
  "¬": "ノット",
  "|": "|",
  "−": "マイナス",
  "⁻": "上付きマイナス",
  "√": "ルート",
  "∞": "無限大",
  "∩": "積集合",
  "∪": "和集合",
  "≈": "ニアリーイコール",
  "≡": "恒等",
  "≤": "小なりイコール",
  "≥": "大なりイコール",
  "⊂": "真部分集合",
  "▲": "上三角",
  "▼": "下三角",
  "◊": "ひし形",
  "○": "白丸",
  "●": "黒丸",
  "◯": "白丸",
  "♪": "音符",
  "♭": "フラット",
  "♯": "シャープ",
};
